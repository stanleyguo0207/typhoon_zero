# Typhoon Xlsx

本工具作为**Typhoon**数据解析工具。

## 前言

游戏开发中，策划配置数据经常会使用`excel`的的方式，所以开发此工具的目的在于将策划配置的
数据转化为程序中的数据文件。

## 数据表格式要求

- 第一行为此列字段的标签定义，程序解析用
- 第二行为此列字段的说明，策划阅读用
- 第三行开始为表格数据

**Demo**
| id[u32][!] | name[str][*] | type[ui8][*] | desc[desc][] |
| :--------: | :----------: | :----------: | :----------: |
|    1001    |    道具1     |      1       |  这是道具1   |
|    1002    |    item2     |      2       |  这是item2   |

上述表格是不可以使用的，完整解析见下方。

### 导出表定义

```markdown
@Item @Equip Desc
sheet表名前带有@符号的表示需要进行导出的表。没有@的符号的表是不会导出的。
表名命名规则为大驼峰命名规范。在c++中作为类名的一部分作为解析。
```

### 字段标签定义规则

google命名规范 https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/#variable-names

```markdown
字段名(必须满足google命名规范) 例如: first_name、last_name。

[] 1位置  字段类型
  支持类型如下:
    double    双精度浮点
    float     单精度浮点
    i8        有符号单字节
    i16       有符号双字节
    i32       有符号四字节
    i64       有符号八字节
    u8        无符号单字节
    i16       无符号双字节
    u32       无符号四字节
    u64       无符号八字节
    str       字符串
    desc      描述内容，本列数据不会被解析
    复合类型见下

    复合类型，需要特殊解析
      u32,u32| 会被解析为u32-u32的结构，经常用着道具id-数量的配置 以|为分隔符，支持
      多个道具配置。
      1001,200|1002,300 会被解析为 (1001,200) (1002,300) 会放到容器中。
      u8,u8,u8| 会被解析为u8-u8-u8的结构。 会被解析为(x,y,z) 类型的数据放到容器中。
    这种结构经常会被用到，至于嵌套类型的复合类型结构，用的并不多，后期可以考虑支持
    , | 符号为默认支持，还支持 ; ^ % # ~ 等非数字字母符号。这些符号是拆解数据的关键。

[] 2位置  字段约束
  ! 标识该列作为主key，多个主key按照顺序拼接，要求所有主key的长度加起来不允许超过八个字节。
    如果没有主键，会取本表中第一个整数字节列为索引。
    另外，主键的概念是不可以重复的，如多主键模式，多主键组合后的结果是不可以重复的。
    主键是不可以为空的，默认会做*处理。!等价于 !*

    因为整个表的数据会被组织成为map的结构读取到程序中，所以key最大暂时支持64位。
  * 该列为必填项，不填写会报错

[] 3位置  字段检查
  导出表名.字段名称
  例如
  equipxxx_id[u32][*][Item.id]
  equipxxx_id本列中的值，会在item表中的id字段中查找，如果未找到则报错。

  如果要在复合类型中做检查操作如下:
  awards[u32,u32|][][Item.id,|]
  本字段含义为 奖励列表 可以数据可以重复，但是复合类型的第一个字段需要在Item表中的id字段
  查询。

  1001,200|1002,300   1001和1002会去Item.id表中查询。
  使用复合类型进行约束的时候，需要格式与复合类型一致，否则约束条件被默认放弃。
```