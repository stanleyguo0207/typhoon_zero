# Typhoon Xlsx

本工具作为**Typhoon**数据解析工具。

![][p_xlsx2data]

- [Typhoon Xlsx](#typhoon-xlsx)
  - [前言](#前言)
  - [数据表格式要求](#数据表格式要求)
    - [导出表定义](#导出表定义)
    - [字段标签定义规则](#字段标签定义规则)
    - [数据结构](#数据结构)

## 前言

游戏开发中，策划配置数据经常会使用`excel`的的方式，所以开发此工具的目的在于将策划配置的
数据转化为程序中的数据文件。

## 数据表格式要求

- 第一行为此列字段的标签定义，程序解析用。
- 第二行为此列字段的说明，策划阅读用。
- 第三行开始为表格数据。

### 导出表定义

- **@** 作为导出表名的前缀

  例如： `@Item`、`@Equip`、`Desc`中`Item`与`Equip`将作为有效表导出。

- 命名规范

  表名命名规则为**大驼峰**命名规范。 `item1`、`iItem`均为非良表名结构。

### 字段标签定义规则

- 字段组成方式

  **字段名**@**字段类型**@**字段约束**@**导出类型**@**字段检查**

  使用`@`分割字段定义，顺序不可以颠倒，排在后面的定义可以为空，但是中间不可以为空。

- 字段名

  - 命名规范

    采用**google**命名规范 https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/naming/#variable-names

- 字段类型

  因为要转换为`json`与`protobuf`，所以类型有所取舍。

  支持类型如下：
  |  xlsx   |  json  | protobuf |
  | :-----: | :----: | :------: |
  | double  | double |  double  |
  |  float  | double |  float   |
  |  float  | double |  float   |
  |   i32   |  int   |  int32   |
  |   i64   | int64  |  int64   |
  |   u32   |  uint  |  uint32  |
  |   u64   | unt64  |  uint64  |
  |  bool   |  bool  |   bool   |
  |   str   | string |  string  |
  |    #    |        |          |
  | complex |        |          |
  
  其中`#`为描述内容，该列数据不会被解析。

  其中`complex`为复合类型。具体解析分情况。

- 字段约束

  - `*`

    该字段为必填项。检查数据时，会检查非空。

  - `!`

    主键标识，如果同表中存在多个主键，按照先后顺序拼接。要求主键集合唯一。检查数据时，
    会检查唯一性。主键一定是非空的，所以自带`*`属性。

- 导出类型

  - c   仅客户端可用
  - s   仅服务器可用
  - cs  默认 服务器 客户端都可用 不填写默认CS

- 字段检查

  `表名.字段名`的组合，数据导出后，会对带有字段检查的字段进行检查。

  如果是复合类型中的字段检查，需要和复合类型的描述一致，无需检查的字段使用`$`站位。



**Demo**
| id@i32@! | name@str@\*@c | type@i32@\* | log_type@i32@@s@Log.type |  desc@#   |
| :------: | :-----------: | :---------: | :----------------------: | :-------: |
|   1001   |     道具1     |      1      |            5             | 这是道具1 |
|   1002   |     item2     |      2      |                          | 这是item2 |

- `id@i32@!`

  | 字段名 | 字段类型 |  字段约束  | 导出类型 | 字段检查 |
  | :----: | :------: | :--------: | :------: | :------: |
  |   id   |   i32    | ! 主键非空 |    cs    |          |

- `name@str@*@c`

  | 字段名 | 字段类型 | 字段约束 | 导出类型 | 字段检查 |
  | :----: | :------: | :------: | :------: | :------: |
  |  name  |   str    |  * 非空  | c 客户端 |          |

- `type@i32@*`

  | 字段名 | 字段类型 | 字段约束 | 导出类型 | 字段检查 |
  | :----: | :------: | :------: | :------: | :------: |
  |  type  |   i32    |  * 非空  |    cs    |          |

- `log_type@i32@@s@Log.type`

  |  字段名  | 字段类型 | 字段约束 | 导出类型 |        字段检查        |
  | :------: | :------: | :------: | :------: | :--------------------: |
  | log_type |   i32    |          | s 服务器 | 检查 Log表中的type字段 |

- `desc@#`

  | 字段名 | 字段类型 | 字段约束 | 导出类型 | 字段检查 |
  | :----: | :------: | :------: | :------: | :------: |
  |  desc  |    #     |          |          |          |

### 数据结构

<!-- image -->
[p_xlsx2data]: ./doc/xlsx2data.png